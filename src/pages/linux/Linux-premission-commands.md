# Linux 之用户权限

## 01. 用户和权限概念

### 1.1 基本概念

- **用户** 是 Linux 系统工作中重要的一环，用户管理包括 **用户** 与 **组管理**

- 在 Linux 系统中，不论是由本机或是远程登录系统，每个系统都必须拥有一个帐号，并且对于不同的系统资源拥有不同的使用权限

- 对 **文件** / **目录** 的权限包括：

  | 序号 | 权限   | 英文   | 缩写 | 数字代号 |
  | ---- | ------ | ------ | ---- | -------- |
  | 01   | 读     | read   | r    | 4        |
  | 02   | 写     | write  | w    | 2        |
  | 03   | 执行   | excude | x    | 1        |
  | 04   | 无权限 |        | -    | 0        |

- 在 Linux 中，可以指定 **每一个用户** 针对 **不同的文件或者目录** 的 **不同权限**

### 1.2 组

- 在实际应用中，可以预先针对 组 设置好权限，然后 将不同的用户添加到对应的组中， 从而不用一次为每一个用户设置权限

### 1.3 `ls -l` 扩展

- `ls -l` 可以查看文件夹下文件的详细信息，从左到右依次是：

  - **权限**： 第1个字符如果是 `d` 表示目录

  - 硬链接数： 通俗讲，就是有多少种方式，可以访问到当前目录 /文件

  - 拥有者： home 目录下 文件/目录 的拥有者通常都是当前用户

  - 组：在 Linux 中，很多时候，会出现组名和用户名相同的情况

  - 大小

  - 时间

  - 名称

### 1.4 `chmod` 简单使用 （重要）

- `chmod`可以修改 用户/组 对 文件/目录 的权限

- 命令格式如下：

```bash
chmod +/-rwx 文件名|目录名

```

> 提示： 以上方式会一次性修改 `拥有者`/ `组` 权限

```bash
chmod -rw file # 去掉 可读可写 权限

chmod +r file # 添加 可读 权限

```

执行文件：

```bash
./01.py # 必须带 ./

```

> 执行 py 文件

> # !/usr/bin/python

### 1.5 超级用户

- Linux 系统中的 `root` 帐号通常 **用于系统的维护和管理**, 对操作系统的所有资源 **具有所有访问权限**

- 在大多数版本的 Linux 中，都不推荐 **直接使用 root 帐号登录系统**

- 在 Linux 安装的过程中，系统会自动创建一个用户帐号，而这个默认的用户就称为 “标准用户”

#### sudo

- `su` 是 `substitute user` 的缩写，表示 **使用另一个用户的身份**

- `sudo` 命令用来以其他身份来执行命令，预设的身份为 `root`

- 用户使用 `sudo` 时，必须先输入密码，之后有 **5分钟的有效期限**,超过期限则必须重新输入密码

> 若其未经授权的用户企图使用 `sudo`, 则会发出警告邮件给管理员

## 02. 组管理 终端命令

> 提示： **创建组/删除组** 的终端命令都需要通过 `sudo`执行

| 序号 | 命令                        | 作用                      |
| ---- | --------------------------- | ------------------------- |
| 01   | `groupadd 组名`             | 添加组                    |
| 02   | `groupdel 组名`             | 删除组                    |
| 03   | `cat /etc/group`            | 确认组信息                |
| 04   | `chgrp -R 组名 文件/目录名` | 递归修改文件/目录的所属组 |

> 提示：

> - 组信息保存在 `/etc/group` 文件中

> - `/etc` 目录是专门用来保存 **系统配置信息** 的目录

在实际应用中，可以预先针对 **组** 设置好权限，然后 **将不同的用户i添加到对应的组中**, 从而 **不用依次为没一个用户设置权限**

## 03. 用户管理终端命令

> 提示： ** 创建用户/删除用户/ 修改其他用户密码** 的终端命令都需要通过 `sudo` 执行

### 3.1 创建用户/设置密码/删除用户

| 序号 | 命令                            | 作用         | 说明                                                         |
| ---- | ------------------------------- | ------------ | ------------------------------------------------------------ |
| 01   | `useradd -m -g 组 新建用户名`   | 添加新用户   | - -m 自动建立用户 home 目录- -g 指定用户所在的组，否则会建立一个同名的组 |
| 02   | `passwd 用户名`                 | 设置用户密码 | 如果是普通用户，直接用 `passwd` 可以修改自己的帐号密码       |
| 03   | `userdel -r 用户名`             | 删除用户     | -r 选项会自动删除用户 home 目录                              |
| 04   | `cat /etc/passwd | grep 用户名` | 确认用户信息 | 新建用户后，用户信息会保存在 `/etc/passwd` 文件中            |

> 提示：

> - 创建用户时，如果忘记添加 `-m` 选项指定新用户的 home -- 最简单的方式就是删除用户，重新创建

> - 创建用户时，默认会创建一个 **用户名**同名的 **组名**

> - 用户信息保存在 `/etc/passwd` 文件中

### 3.2 查看用户信息

| 序号 | 命令        | 作用                       |
| ---- | ----------- | -------------------------- |
| 01   | id [用户名] | 查看用户 UID 和 GID 信息   |
| 02   | who         | 查看当前所有登录的用户列表 |
| 03   | whoami      | 查看当前用户的账户名       |

#### passwd 文件

`/etc/passwd` 文件存放的是用户的信息，由 6 个 分号组成的 7 个信息，分别是

1. 用户名

2. 密码 （x，表示加密的密码）

3. UID （用户标识）

4. GID （组标识）

5. 用户全名或本地帐号

6. home 目录

7. 登录使用的 Shell, 就是登录之后，使用的终端命令

#### usermod

- `usermod` 可以用来设置 **用户** 的 **主组 / 附加组** 和 **登录 shell**, 命令格式如下：

- **主组**: 通常在新建用户时指定，在 `/etc/passwd` 的第 4 列 GID对应的组

- **附加组**：在 `/etc/group` 中最后一列表示该组的用户列表，用于制定 **用户的附加权限**


### 3.3 修改文件和目录的所有者和所属组

chown 命令，可以认为是 "change owner" 的缩写，主要用于修改文件（或目录）的所有者，这个命令也可以修改文件（或目录）的所属组。

当只需要修改所有者时，可以使用如下 chown 命令的基本格式：

```bash
$ chown [-R] 所有者 文件/目录 
```
> -R 大写 选项表示连同子目录中的所有文件，都更改所有者

如果需要同时更改所有者和所有组，chown 命令的基本格式为：

```bash
$ chown [-R] 所有者:所属组 文件/目录
```
